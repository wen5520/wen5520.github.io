<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>木子吻雨叚</title>
    <meta name="description" content="iskeys.cn">
    <link rel="icon" href="/img/logo.ico">
    
    <link rel="preload" href="/assets/css/0.styles.8d0c462e.css" as="style"><link rel="preload" href="/assets/js/app.a25bb546.js" as="script"><link rel="preload" href="/assets/js/15.ceaca50a.js" as="script"><link rel="prefetch" href="/assets/js/10.444e678e.js"><link rel="prefetch" href="/assets/js/11.195b1e8a.js"><link rel="prefetch" href="/assets/js/12.84abb38f.js"><link rel="prefetch" href="/assets/js/13.f00fe086.js"><link rel="prefetch" href="/assets/js/14.71867c41.js"><link rel="prefetch" href="/assets/js/16.1e699b03.js"><link rel="prefetch" href="/assets/js/17.00b82ccc.js"><link rel="prefetch" href="/assets/js/18.4e23ebbe.js"><link rel="prefetch" href="/assets/js/19.990dc36c.js"><link rel="prefetch" href="/assets/js/2.f0a7de9b.js"><link rel="prefetch" href="/assets/js/20.971c5589.js"><link rel="prefetch" href="/assets/js/21.e8af605d.js"><link rel="prefetch" href="/assets/js/22.ec4d39b2.js"><link rel="prefetch" href="/assets/js/3.fcbaad06.js"><link rel="prefetch" href="/assets/js/4.1a59f044.js"><link rel="prefetch" href="/assets/js/5.7f72f4f9.js"><link rel="prefetch" href="/assets/js/6.0fd6d6d7.js"><link rel="prefetch" href="/assets/js/7.7e13912f.js"><link rel="prefetch" href="/assets/js/8.b4bea97e.js"><link rel="prefetch" href="/assets/js/9.2b6f51d8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8d0c462e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">木子吻雨叚</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/english/introduction.html" class="nav-link">英文阅读</a></div><div class="nav-item"><a href="/note/es6/es6.html" class="nav-link">笔记</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/english/introduction.html" class="nav-link">英文阅读</a></div><div class="nav-item"><a href="/note/es6/es6.html" class="nav-link">笔记</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/introduction.html" class="sidebar-link">导读</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>es6</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/note/es6/es6.html" class="sidebar-link">es6</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/note/vue/error.html" class="sidebar-link">/note/vue/error.html</a></li><li><a href="/note/vue/vue.html" class="sidebar-link">vue</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>react</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/note/react/react.html" class="sidebar-link">react</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>taro</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/note/taro/cropper.html" class="sidebar-link">/note/taro/cropper.html</a></li><li><a href="/note/taro/image-cropper.html" class="active sidebar-link">/note/taro/image-cropper.html</a></li><li><a href="/note/taro/taro.html" class="sidebar-link">taro</a></li><li><a href="/note/taro/updata.html" class="sidebar-link">/note/taro/updata.html</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>vite</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/note/vite/vite.html" class="sidebar-link">搭建第一个vite项目 vite</a></li><li><a href="/note/vite/vite2.html" class="sidebar-link">前端杨村长创建vite项目</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span>vue
<span class="token operator">&lt;</span>template src<span class="token operator">=</span><span class="token string">&quot;./template.html&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Taro <span class="token keyword">from</span> <span class="token string">&quot;@tarojs/taro&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 图片路径
     */</span>
    imgSrc<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 裁剪框高度
     */</span>
    height<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 裁剪框宽度
     */</span>
    width<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 裁剪框最小尺寸
     */</span>
    min_width<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    min_height<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 裁剪框最大尺寸
     */</span>
    max_width<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    max_height<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 裁剪框禁止拖动
     */</span>
    disable_width<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    disable_height<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 锁定裁剪框比例
     */</span>
    disable_ratio<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 生成的图片尺寸相对剪裁框的比例
     */</span>
    export_scale<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 生成的图片质量0-1
     */</span>
    quality<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cut_top<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cut_left<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * canvas上边距（不设置默认不显示）
     */</span>
    canvas_top<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * canvas左边距（不设置默认不显示）
     */</span>
    canvas_left<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 图片宽度
     */</span>
    img_width<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 图片高度
     */</span>
    img_height<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 图片缩放比
     */</span>
    scale<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 图片旋转角度
     */</span>
    angle<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 最小缩放比
     */</span>
    min_scale<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 最大缩放比
     */</span>
    max_scale<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 是否禁用旋转
     */</span>
    disable_rotate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 是否限制移动范围(剪裁框只能在图片内)
     */</span>
    limit_move<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//监听截取框宽高变化</span>
    <span class="token function">width</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_width<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">height</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_height<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">angle</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token comment">//停止居中裁剪框，继续修改图片位置</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>limit_move<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">%</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">90</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_cut_animation</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//开启过渡300毫秒之后自动关闭</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation_time <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">limit_move</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">%</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">90</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">canvas_top</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_canvasDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">canvas_left</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_canvasDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">imgSrc</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pushImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">cut_top</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_cutDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>limit_move<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">cut_left</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_cutDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>limit_move<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">:</span> <span class="token string">&quot;image-cropper&quot;</span><span class="token punctuation">,</span> <span class="token comment">//暂时无用</span>
      info<span class="token punctuation">:</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token constant">MOVE_THROTTLE</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//触摸移动节流settimeout</span>
      <span class="token constant">MOVE_THROTTLE_FLAG</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//节流标识</span>
      <span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//图片设置尺寸,此值不变（记录最初设定的尺寸）</span>
      <span class="token constant">INIT_IMGHEIGHT</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//图片设置尺寸,此值不变（记录最初设定的尺寸）</span>
      <span class="token constant">TIME_BG</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//背景变暗延时函数</span>
      <span class="token constant">TIME_CUT_CENTER</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _touch_img_relative<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//鼠标和图片中心的相对位置</span>
      _flag_cut_touch<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否是拖动裁剪框</span>
      _hypotenuse_length<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//双指触摸时斜边长度</span>
      _flag_img_endtouch<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否结束触摸</span>
      _flag_bright<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//背景是否亮</span>
      _canvas_overflow<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//canvas缩略图是否在屏幕外面</span>
      _canvas_width<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      _canvas_height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      origin_x<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">//图片旋转中心</span>
      origin_y<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">//图片旋转中心</span>
      _cut_animation<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否开启图片和裁剪框过渡</span>
      _img_top<span class="token punctuation">:</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>windowHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//图片上边距</span>
      _img_left<span class="token punctuation">:</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//图片左边距</span>
      _img_width<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _img_height<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _width<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      _height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      _cut_top<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _cut_left<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _canvas_top<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _canvas_left<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      _angle<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      _scale<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启用数据监听</span>
    <span class="token comment">// this._watcher();</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cut_top<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cut_left<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas_top<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas_left<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>angle<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scale<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>img_width<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>img_height<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// this.imgSrc &amp;&amp; (this.imgSrc = this.imgSrc);</span>
    <span class="token comment">//根据开发者设置的图片目标尺寸计算实际尺寸</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initImageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置裁剪框大小&gt;设置图片尺寸&gt;绘制canvas</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//检查裁剪框是否在范围内</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_cutDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//检查canvas是否在范围内</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_canvasDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化完成</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cropper<span class="token punctuation">:</span> <span class="token keyword">this</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 上传图片
     */</span>
    <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        sizeType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;original&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;compressed&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        sourceType<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;album&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;camera&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> tempFilePaths <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">pushImg</span><span class="token punctuation">(</span>tempFilePaths<span class="token punctuation">)</span><span class="token punctuation">;</span>
          wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token string">&quot;加载中...&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 返回图片信息
     */</span>
    <span class="token function">getImg</span><span class="token punctuation">(</span><span class="token parameter">getCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">canvasToTempFilePath</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">)</span><span class="token punctuation">,</span>
            destWidth<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
            destHeight<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
            fileType<span class="token punctuation">:</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">,</span>
            quality<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>quality<span class="token punctuation">,</span>
            canvasId<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">getCallback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                url<span class="token punctuation">:</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
                width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">this</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置图片动画
     * {
     *    x:10,//图片在原有基础上向下移动10px
     *    y:10,//图片在原有基础上向右移动10px
     *    angle:10,//图片在原有基础上旋转10deg
     *    scale:0.5,//图片在原有基础上增加0.5倍
     * }
     */</span>
    <span class="token function">setTransform</span><span class="token punctuation">(</span><span class="token parameter">transform</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transform<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>scale<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>transform<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_rotate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> transform<span class="token punctuation">.</span>angle
          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">+</span> transform<span class="token punctuation">.</span>angle
          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_angle<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">+</span> transform<span class="token punctuation">.</span>scale<span class="token punctuation">;</span>
        scale <span class="token operator">=</span> scale <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_scale <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_scale <span class="token punctuation">:</span> scale<span class="token punctuation">;</span>
        scale <span class="token operator">=</span> scale <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_scale <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_scale <span class="token punctuation">:</span> scale<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> scale<span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutX <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>cutX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> cutX <span class="token operator">+</span> transform<span class="token punctuation">.</span>cutX<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>watch<span class="token punctuation">.</span><span class="token function">cut_left</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transform<span class="token punctuation">.</span>cutY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> cutY <span class="token operator">+</span> transform<span class="token punctuation">.</span>cutY<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>watch<span class="token punctuation">.</span><span class="token function">cut_top</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> transform<span class="token punctuation">.</span>y <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">+</span> transform<span class="token punctuation">.</span>y <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> transform<span class="token punctuation">.</span>x
        <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">+</span> transform<span class="token punctuation">.</span>x
        <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">;</span>
      <span class="token comment">//图像边缘检测,防止截取到空白</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//停止居中裁剪框，继续修改图片位置</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">;</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//可以居中裁剪框了</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结束操作</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置剪裁框位置
     */</span>
    <span class="token function">setCutXY</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> y<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置剪裁框尺寸
     */</span>
    <span class="token function">setCutSize</span><span class="token punctuation">(</span><span class="token parameter">w<span class="token punctuation">,</span> h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> w<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> h<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置剪裁框和图片居中
     */</span>
    <span class="token function">setCutCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> cut_top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cut_left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
      <span class="token comment">//顺序不能变</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> cut_top<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> cut_top<span class="token punctuation">;</span> <span class="token comment">//截取的框上边距</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> cut_left<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> cut_left<span class="token punctuation">;</span> <span class="token comment">//截取的框左边距</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_setCutCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;_setCutCenter&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cut_top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cut_left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cut_top<span class="token punctuation">,</span> cut_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> cut_top<span class="token punctuation">;</span> <span class="token comment">//截取的框上边距</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> cut_left<span class="token punctuation">;</span> <span class="token comment">//截取的框左边距</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置剪裁框宽度-即将废弃
     */</span>
    <span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token parameter">width</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> width<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置剪裁框高度-即将废弃
     */</span>
    <span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> height<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 是否锁定旋转
     */</span>
    <span class="token function">setDisableRotate</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>disable_rotate <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 是否限制移动
     */</span>
    <span class="token function">setLimitMove</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>limit_move <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 初始化图片，包括位置、大小、旋转角度
     */</span>
    <span class="token function">imgReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;imgReset&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// this._scale = 1;</span>
      <span class="token comment">// this._angle = 0;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>windowHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 加载（更换）图片
     */</span>
    <span class="token function">pushImg</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc <span class="token operator">=</span> src<span class="token punctuation">;</span>
        <span class="token comment">//发现是手动赋值直接返回，交给watch处理</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// getImageInfo接口传入 src: '' 会导致内存泄漏</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pushImg&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      wx<span class="token punctuation">.</span><span class="token function">getImageInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        src<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject <span class="token operator">=</span> res<span class="token punctuation">;</span>
          <span class="token comment">//图片非本地路径需要换成本地路径</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex">/tmp/</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc <span class="token operator">=</span> res<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">//计算最后图片尺寸</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgComputeSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>limit_move<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//限制移动，不留空白处理</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">imageLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;imageload&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置图片放大缩小
     */</span>
    <span class="token function">setScale</span><span class="token punctuation">(</span><span class="token parameter">scale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>scale<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> scale<span class="token punctuation">;</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 设置图片旋转角度
     */</span>
    <span class="token function">setAngle</span><span class="token punctuation">(</span><span class="token parameter">angle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>angle<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> angle<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_initCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//初始化canvas</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">&quot;image-cropper&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;_initCanvas&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 根据开发者设置的图片目标尺寸计算实际尺寸
     */</span>
    <span class="token function">_initImageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//处理宽高特殊单位 %&gt;px</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span> <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width <span class="token operator">=</span>
          <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> width<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height <span class="token operator">=</span>
          <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> height<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 检测剪裁框位置是否在允许的范围内(屏幕内)
     */</span>
    <span class="token function">_cutDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token function-variable function">_cutDetectionPositionTop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//检测上边距是否在范围内</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">_cutDetectionPositionLeft</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//检测左边距是否在范围内</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">//裁剪框坐标处理（如果只写一个参数则另一个默认为0，都不写默认居中）</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setCutCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_cutDetectionPositionTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_cutDetectionPositionLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_cutDetectionPositionTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_cutDetectionPositionLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 检测canvas位置是否在允许的范围内(屏幕内)如果在屏幕外则不开启实时渲染
     * 如果只写一个参数则另一个默认为0，都不写默认超出屏幕外
     */</span>
    <span class="token function">_canvasDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&quot;_canvasDetectionPosition&quot;</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">||</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">||</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_left<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_top<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 图片边缘检测-位置
     */</span>
    <span class="token function">_imgMarginDetectionPosition</span><span class="token punctuation">(</span><span class="token parameter">_scale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>limit_move<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">;</span>
      <span class="token keyword">let</span> top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">;</span>
      <span class="token keyword">let</span> scale <span class="token operator">=</span> _scale <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale<span class="token punctuation">;</span>
      <span class="token keyword">let</span> img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width<span class="token punctuation">;</span>
      <span class="token keyword">let</span> img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">;</span>
        img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      left <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token punctuation">(</span>img_width <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&gt;=</span> left
          <span class="token operator">?</span> left
          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token punctuation">(</span>img_width <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      left <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">-</span> <span class="token punctuation">(</span>img_width <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;=</span> left
          <span class="token operator">?</span> left
          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">-</span> <span class="token punctuation">(</span>img_width <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      top <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token punctuation">(</span>img_height <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&gt;=</span> top
          <span class="token operator">?</span> top
          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token punctuation">(</span>img_height <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      top <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">-</span> <span class="token punctuation">(</span>img_height <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;=</span> top
          <span class="token operator">?</span> top
          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">-</span> <span class="token punctuation">(</span>img_height <span class="token operator">*</span> scale<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> left<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> top<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> scale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 图片边缘检测-缩放
     */</span>
    <span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>limit_move<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale<span class="token punctuation">;</span>
      <span class="token keyword">let</span> img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width<span class="token punctuation">;</span>
      <span class="token keyword">let</span> img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">;</span>
        img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>img_width <span class="token operator">*</span> scale <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">/</span> img_width<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>img_height <span class="token operator">*</span> scale <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scale <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>scale<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">/</span> img_height<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionPosition</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_setData</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 计算图片尺寸
     */</span>
    <span class="token function">_imgComputeSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width<span class="token punctuation">,</span>
        img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//默认按图片最小边 = 对应裁剪框尺寸</span>
        img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>img_width <span class="token operator">/</span> img_height <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">;</span>
          img_width <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> img_height<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">;</span>
          img_height <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> img_width<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        img_width <span class="token operator">=</span>
          <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">*</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGHEIGHT</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        img_height <span class="token operator">=</span>
          <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageObject<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">*</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">INIT_IMGWIDTH</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width <span class="token operator">=</span> img_width<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height <span class="token operator">=</span> img_height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//改变截取框大小</span>
    <span class="token function">_computeCutSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>windowHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//开始触摸</span>
    <span class="token function">_start</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>touches<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//单指拖动</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          x<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">,</span>
          y<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//双指放大</span>
        <span class="token keyword">let</span> width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
          event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
          event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            x<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">,</span>
            y<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            x<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">,</span>
            y<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_hypotenuse_length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>
          Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_move_throttle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//安卓需要节流</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">.</span>platform <span class="token operator">==</span> <span class="token string">&quot;android&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE</span> <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_move</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_move_throttle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>touches<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//单指拖动</span>
        <span class="token keyword">let</span> left <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
          top <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token comment">//图像边缘检测,防止截取到空白</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> top<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//双指放大</span>
        <span class="token keyword">let</span> width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
            event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
            event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          hypotenuse <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">*</span> <span class="token punctuation">(</span>hypotenuse <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_hypotenuse_length<span class="token punctuation">)</span><span class="token punctuation">,</span>
          current_deg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        scale <span class="token operator">=</span> scale <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_scale <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_scale <span class="token punctuation">:</span> scale<span class="token punctuation">;</span>
        scale <span class="token operator">=</span> scale <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_scale <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_scale <span class="token punctuation">:</span> scale<span class="token punctuation">;</span>
        <span class="token comment">//图像边缘检测,防止截取到空白</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> scale<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//双指旋转(如果没禁用旋转)</span>
        <span class="token keyword">let</span> _touch_img_relative <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            x<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">,</span>
            y<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            x<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left<span class="token punctuation">,</span>
            y<span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_rotate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> first_atan <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">*</span>
            Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> _touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> first_atan_old <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">*</span>
            Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> second_atan <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">*</span>
            Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> _touch_img_relative<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> second_atan_old <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">*</span>
            Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//当前旋转的角度</span>
          <span class="token keyword">let</span> first_deg <span class="token operator">=</span> first_atan <span class="token operator">-</span> first_atan_old<span class="token punctuation">,</span>
            second_deg <span class="token operator">=</span> second_atan <span class="token operator">-</span> second_atan_old<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>first_deg <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            current_deg <span class="token operator">=</span> first_deg<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>second_deg <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            current_deg <span class="token operator">=</span> second_deg<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_touch_img_relative <span class="token operator">=</span> _touch_img_relative<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_hypotenuse_length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>
          Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//更新视图</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">+</span> current_deg<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_overflow <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//结束操作</span>
    <span class="token function">_end</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//点击中间剪裁框处理</span>
    <span class="token function">_click</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//调起上传</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_draw</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>detail <span class="token operator">?</span> event<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>x <span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
        <span class="token keyword">let</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span>detail <span class="token operator">?</span> event<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>y <span class="token punctuation">:</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          x <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">&amp;&amp;</span>
          x <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">&amp;&amp;</span>
          y <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">&amp;&amp;</span>
          y <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">//生成图片并回调</span>
          wx<span class="token punctuation">.</span><span class="token function">canvasToTempFilePath</span><span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
              width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
              height<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">)</span><span class="token punctuation">,</span>
              destWidth<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
              destHeight<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
              fileType<span class="token punctuation">:</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">,</span>
              quality<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>quality<span class="token punctuation">,</span>
              canvasId<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span>
              <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;tapcut&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;tapcut&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  url<span class="token punctuation">:</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
                  height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//渲染</span>
    <span class="token function">_draw</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;_draw&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//图片实际大小</span>
        <span class="token keyword">let</span> img_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">;</span>
        <span class="token keyword">let</span> img_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_height <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scale <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">;</span>
        <span class="token comment">//canvas和图片的相对距离</span>
        <span class="token keyword">let</span> xpos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_left <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">;</span>
        <span class="token keyword">let</span> ypos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_img_top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">;</span>
        <span class="token comment">//旋转画布</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>xpos <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">,</span> ypos <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>export_scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_angle <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>imgSrc<span class="token punctuation">,</span>
          <span class="token operator">-</span>img_width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token operator">-</span>img_height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
          img_width<span class="token punctuation">,</span>
          img_height
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>height<span class="token punctuation">,</span> draw<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>width <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>height <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//优化拖动裁剪框，所以必须把宽高设置放在离用户触发渲染最近的地方</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas_width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">;</span>
        <span class="token comment">//延迟40毫秒防止点击过快出现拉伸或裁剪过多</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//裁剪框处理</span>
    <span class="token function">_cutTouchMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_flag_cut_touch <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_ratio <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_width <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disable_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//节流</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">MOVE_THROTTLE_FLAG</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_move_throttle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">,</span>
          height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">,</span>
          cut_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">,</span>
          cut_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">,</span>
          <span class="token function-variable function">size_correct</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            width <span class="token operator">=</span>
              width <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_width
                <span class="token operator">?</span> width <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_width
                  <span class="token operator">?</span> width
                  <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_width
                <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_width<span class="token punctuation">;</span>
            height <span class="token operator">=</span>
              height <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_height
                <span class="token operator">?</span> height <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_height
                  <span class="token operator">?</span> height
                  <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_height
                <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_height<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">size_inspect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
              <span class="token punctuation">(</span>width <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_width <span class="token operator">||</span>
                width <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_width <span class="token operator">||</span>
                height <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max_height <span class="token operator">||</span>
                height <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min_height<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>disable_ratio
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">size_correct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">size_correct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        height <span class="token operator">=</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>height <span class="token operator">+</span>
          <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>corner <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>corner <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>y <span class="token operator">-</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>corner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
            width <span class="token operator">=</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>x <span class="token operator">-</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_ratio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              height <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">size_inspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            cut_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>cut_left <span class="token operator">-</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
            width <span class="token operator">=</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>x <span class="token operator">-</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_ratio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              height <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">size_inspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            cut_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>cut_top <span class="token operator">-</span> <span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cut_left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>cut_left <span class="token operator">-</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
            width <span class="token operator">=</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>x <span class="token operator">+</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_ratio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              height <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">size_inspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            cut_top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>cut_top <span class="token operator">-</span> <span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
            width <span class="token operator">=</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span><span class="token punctuation">.</span>x <span class="token operator">+</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_ratio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              height <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">size_inspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_width <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> width<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> cut_left<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> height<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> cut_top<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">=</span> width<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">=</span> cut_left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>disable_height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">=</span> height<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">=</span> cut_top<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_imgMarginDetectionScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_cutTouchStart</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> currentX <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
      <span class="token keyword">let</span> currentY <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_top4 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_bottom4 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_left4 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_right4 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> cutbox_top3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_bottom3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_left3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_right3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> cutbox_top2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_bottom2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_left2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_right2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> cutbox_top1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_bottom1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_left1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> cutbox_right1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        currentX <span class="token operator">&gt;</span> cutbox_left4 <span class="token operator">&amp;&amp;</span>
        currentX <span class="token operator">&lt;</span> cutbox_right4 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&gt;</span> cutbox_top4 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&lt;</span> cutbox_bottom4
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_cut_touch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">,</span>
          x<span class="token punctuation">:</span> currentX<span class="token punctuation">,</span>
          y<span class="token punctuation">:</span> currentY<span class="token punctuation">,</span>
          corner<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        currentX <span class="token operator">&gt;</span> cutbox_left3 <span class="token operator">&amp;&amp;</span>
        currentX <span class="token operator">&lt;</span> cutbox_right3 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&gt;</span> cutbox_top3 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&lt;</span> cutbox_bottom3
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_cut_touch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">,</span>
          x<span class="token punctuation">:</span> currentX<span class="token punctuation">,</span>
          y<span class="token punctuation">:</span> currentY<span class="token punctuation">,</span>
          cut_top<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">,</span>
          cut_left<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">,</span>
          corner<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        currentX <span class="token operator">&gt;</span> cutbox_left2 <span class="token operator">&amp;&amp;</span>
        currentX <span class="token operator">&lt;</span> cutbox_right2 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&gt;</span> cutbox_top2 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&lt;</span> cutbox_bottom2
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_cut_touch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">,</span>
          cut_top<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">,</span>
          cut_left<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">,</span>
          x<span class="token punctuation">:</span> currentX<span class="token punctuation">,</span>
          y<span class="token punctuation">:</span> currentY<span class="token punctuation">,</span>
          corner<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        currentX <span class="token operator">&gt;</span> cutbox_left1 <span class="token operator">&amp;&amp;</span>
        currentX <span class="token operator">&lt;</span> cutbox_right1 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&gt;</span> cutbox_top1 <span class="token operator">&amp;&amp;</span>
        currentY <span class="token operator">&lt;</span> cutbox_bottom1
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_cut_touch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_img_endtouch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">CUT_START</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token punctuation">,</span>
          cut_top<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_top<span class="token punctuation">,</span>
          cut_left<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_left<span class="token punctuation">,</span>
          x<span class="token punctuation">:</span> currentX<span class="token punctuation">,</span>
          y<span class="token punctuation">:</span> currentY<span class="token punctuation">,</span>
          corner<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_cutTouchEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_moveStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_cut_touch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//停止移动时需要做的操作</span>
    <span class="token function">_moveStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//清空之前的自动居中延迟函数并添加最新的</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIME_CUT_CENTER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIME_CUT_CENTER</span> <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//动画启动</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_cut_animation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCutCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//清空之前的背景变化延迟函数并添加最新的</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIME_BG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIME_BG</span> <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_flag_bright<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_bright <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//移动中</span>
    <span class="token function">_moveDuring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//清空之前的自动居中延迟函数</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIME_CUT_CENTER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//清空之前的背景变化延迟函数</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">TIME_BG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//高亮背景</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_flag_bright<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_flag_bright <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//监听器</span>
    <span class="token function">_watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>watch<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_observe</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> watchFun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          val <span class="token operator">=</span> value<span class="token punctuation">;</span>
          watchFun <span class="token operator">&amp;&amp;</span> <span class="token function">watchFun</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            val <span class="token operator">&amp;&amp;</span>
            <span class="token string">&quot;_img_top|img_left||width|height|min_width|max_width|min_height|max_height|export_scale|cut_top|cut_left|canvas_top|canvas_left|img_width|img_height|scale|angle|min_scale|max_scale&quot;</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>
              key
            <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span> val<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              ret <span class="token operator">+=</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_preventTouchMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">&quot;scss&quot;</span><span class="token operator">&gt;</span>
@<span class="token keyword">import</span> <span class="token string">&quot;./style.scss&quot;</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/10/2022, 11:43:06 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/note/taro/cropper.html" class="prev">
          /note/taro/cropper.html
        </a></span> <span class="next"><a href="/note/taro/taro.html">
          taro
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.a25bb546.js" defer></script><script src="/assets/js/15.ceaca50a.js" defer></script>
  </body>
</html>
